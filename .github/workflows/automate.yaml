name: Clone to VPS and run all logics

on: push
jobs:
  repo-ubuntu:
    runs-on: self-hosted
    steps:
      - name: cores check
        run: nproc  
      - name: clone-repo
        uses: GuillaumeFalourd/clone-github-repo-action@v2
        id: repo
        with:
          owner: 'anapitalai'
          repository: 'raliku-holdings'
      
      - name: avaiable-repo
        if: failure() || success()
        run: |
          rm raliku-holdings -R

  vps-operations:
    needs: repo-ubuntu
    runs-on: self-hosted
    steps:
      -name: browser files
      run: | 
       cd /root/git-clones/raliku-holdings
       ls -lah
       npm ci
       npm run build    
      # - name: Get artifacts
      #   uses: actions/download-artifact@v3
      #   with:
      #     name: artifact-build-files
          
  #     - name: copy code into VPS
  #       uses: actions/checkout@v3
  #     - name: some if node_modules is there
  #       run: ls           

             
        
      # - name: Access cloned repository content
      #   run: mv raliku-holdings /root/git-clones/
      # - name: cd to the dir    
      #   run:  cd /root/git-clones/raliku-holdings
          
  #         npm ci
  #         npm run build
  #         pwd
  #     - name: work with artifacts
  #       uses: actions/upload-artifact@v3
  #       with:
  #         name: artifact-build-files
  #         path: /home/runner/work/raliku-holdings/raliku-holdings/raliku-holdings/frontend/build

  # vps-operations:
  #   needs: repo-ubuntu
  #   runs-on: self-hosted
  #   steps:
  #     - name: Get artifacts
  #       uses: actions/download-artifact@v3
  #       with:
  #         name: artifact-build-files
          
      # - name: copy code into VPS
      #   uses: actions/checkout@v3
      # - name: some if node_modules is there
      #   run: ls
##/root/actions-runner/_work/raliku-holdings/raliku-holdings
# name: Deployment

# on: push
# jobs:
#   installs:
#     runs-on: ubuntu-latest
#     steps:
#     - name: Get code from local to gh runner
#       uses: actions/checkout@v3

#     - name: Copy folder content recursively to remote VPS
#       uses: garygrossgarten/github-action-scp@release
#       with:
#           local: /home/runner/work/raliku-holdings/
#           remote: /root/git-clones/
#           host: ${{ secrets.HOST }}
#           username: ${{ secrets.USER }}
#           password: ${{ secrets.PASSWORD }}
#   prep-deploy:
#     runs-on: self-hosted
#     steps:
#     - name: Get to the project dir
#       run: cd /root/git-clones/raliku-holdings
#     - name: install and build
#       run: npm ci
#     - name: install frontend deps
#       run: npm run build && npm run dev
